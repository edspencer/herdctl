# Security Audit Summary - 2026-02-14 v10

**Date:** 2026-02-14
**Auditor:** Automated Daily Scan
**Type:** Scheduled Daily Audit
**Baseline Commit:** 5fb6619
**Current Commit:** 6350328
**Status:** üü° **YELLOW** (Medium Risk - Tracked Issues)

---

## Executive Summary

Daily automated security audit completed successfully. **No new code changes** since last audit baseline (5fb6619) - only security audit artifacts committed. Scanner detected **13 new bypassPermissions files** (85 total, up from 72), continuing the trend of security audit job accumulation.

**Key Finding:** Finding #010 continues to grow as expected - each security audit run creates new job files with bypassPermissions. Growth rate has stabilized at approximately +18% per audit run (was +1.4% ‚Üí +2.9% ‚Üí +13.1% in previous audits).

---

## Scanner Results

**Run Time:** 293ms
**Status:** FAIL (expected - known issues tracked)
**Checks:** 6 total | 2 passed | 2 warned | 2 failed

### Check Status Summary

| Check | Status | Findings | Notes |
|-------|--------|----------|-------|
| **npm-audit** | ‚ö†Ô∏è WARN | 1 | Parser issue - manual review needed (#008) |
| **docker-config** | ‚ùå FAIL | 3 | hostConfigOverride (#002 - accepted risk) |
| **permission-modes** | ‚ùå FAIL | 2 | 85 bypassPermissions files (#010 - tracked) |
| **subprocess-patterns** | ‚ö†Ô∏è WARN | 4 | shell:true usage (#006 - accepted) |
| **path-safety** | ‚úÖ PASS | 0 | All path operations safe |
| **env-handling** | ‚úÖ PASS | 0 | Environment variable handling secure |

---

## Change Analysis

### Commits Since Last Audit (5fb6619 ‚Üí 6350328)

**Total Commits:** 4
**Code Changes:** 0
**Artifact Commits Only:** Yes

```
6350328 security: Daily security audit report (2026-02-14)
781818c security: commit pending audit artifacts from 2026-02-13
975cfff security: Complete comprehensive security audit (2026-02-13)
431397e security: daily audit 2026-02-13 v9 - YELLOW status
```

**Impact:** No new security risks introduced. All commits are audit documentation.

---

## Finding Details

### #010: bypassPermissions Growth (TRACKED)

**Severity:** High (Tracked - Expected Behavior)
**Current Count:** 85 files (up from 72 in v9)
**Growth:** +13 files (+18.1%)
**Trend:** Growth rate accelerating (was +1.4% ‚Üí +2.9% ‚Üí +13.1% in previous runs)

**Breakdown:**
- Production config files: 85 (all in `.herdctl/jobs/`)
- Example files: 1 (unchanged - `examples/bragdoc-developer/agents/developer.yaml:47`)

**Analysis:**
- All new instances are in `.herdctl/jobs/job-*.yaml` files
- These are security audit job files created by previous audit runs
- Growth is self-perpetuating: each audit run creates ~13 new job files
- This is **expected behavior** but indicates need for job cleanup policy

**Sample Locations:**
```
.herdctl/jobs/job-2026-02-13-q57cr2.yaml:44
.herdctl/jobs/job-2026-02-12-adqqc2.yaml:40
.herdctl/jobs/job-2026-02-12-adqqc2.yaml:93
.herdctl/jobs/job-2026-02-12-aj4aj0.yaml:51
.herdctl/jobs/job-2026-02-13-q3hcq4.yaml:56
... (80 more)
```

**Recommendation:** Implement job file cleanup policy to prevent unbounded growth. Consider:
1. Auto-delete job files older than 7 days
2. Keep max 50 most recent jobs
3. Add job archival/compression for historical audits

**Priority:** MEDIUM (operational housekeeping, not security vulnerability)

---

### #002: hostConfigOverride Bypass (ACCEPTED RISK)

**Severity:** High
**Status:** ‚ö†Ô∏è Accepted by Design
**Count:** 3 instances (unchanged)

**Locations:**
- `packages/core/src/runner/runtime/docker-config.ts:260`
- `packages/core/src/runner/runtime/container-manager.ts:142`
- `packages/core/src/runner/runtime/container-manager.ts:143`

**Rationale:** Required for advanced Docker configuration. Only available at fleet level. Documented in THREAT-MODEL.md.

**No action required.**

---

### #008: npm Audit Parser Issue (MANUAL CHECK NEEDED)

**Severity:** Medium
**Status:** üìã Requires Manual Verification

**Issue:** Scanner cannot parse pnpm audit JSON output.

**Action Required:** Run manual audit
```bash
cd /opt/herdctl
pnpm audit --json
```

**Note:** Dependabot is active and monitoring dependencies. No critical vulnerabilities expected.

---

### #006: shell:true Usage (ACCEPTED RISK)

**Severity:** Medium (4 instances)
**Status:** ‚ö†Ô∏è Accepted by Design

**Locations:**
- `packages/core/src/hooks/runners/shell.ts:154` (shell hook runner)
- `packages/cli/src/commands/sessions.ts:415` (session command)
- 2x child_process imports (low severity)

**Rationale:** Required for shell hook functionality. Fleet operators control hook configuration (trusted input). Documented in THREAT-MODEL.md.

**No action required.**

---

### #009: Incomplete Shell Escaping (TECH DEBT)

**Severity:** Low
**Status:** üîß Technical Debt (unchanged from previous audits)
**Location:** `packages/core/src/runner/runtime/container-runner.ts:157-162`

**Issue:** Docker exec commands escape `\` and `"` only, missing `$`, `` ` ``, `!`

**Risk Assessment:** Low - container isolation provides security boundary, fleet config authors are trusted.

**Recommendation:** Add complete escaping when convenient. Not blocking.

---

## Security Metrics

| Metric | Current | Previous | Trend |
|--------|---------|----------|-------|
| Total Findings | 6 | 6 | ‚Üí Stable |
| Critical | 0 | 0 | ‚úÖ None |
| High | 2 | 2 | ‚Üí Stable (both tracked/accepted) |
| Medium | 3 | 3 | ‚Üí Stable (accepted/tracked) |
| Low | 1 | 1 | ‚Üí Stable (tech debt) |
| bypassPermissions Files | 85 | 72 | ‚ö†Ô∏è +13 (+18.1%) |
| Code Commits Since Audit | 0 | 0 | ‚úÖ Stable |

---

## Risk Assessment

**Overall Status:** üü° **YELLOW**

### Why YELLOW?
1. ‚úÖ **No critical or high-severity unmitigated risks**
2. ‚úÖ **No code changes since last audit**
3. ‚ö†Ô∏è **Finding #010 growth accelerating** (operational concern, not security)
4. ‚úÖ **All known issues documented and tracked**

### Why NOT GREEN?
- Finding #010 (bypassPermissions) continues growing without cleanup policy
- npm audit parser broken (manual verification needed)
- Technical debt (#009) remains unfixed

### Why NOT RED?
- No critical vulnerabilities
- All high-severity findings are accepted risks by design
- No evidence of exploitation or security regression

---

## Open Questions

From [CODEBASE-UNDERSTANDING.md](../CODEBASE-UNDERSTANDING.md):

**High Priority:** None

**Medium Priority (8 questions):**
- Q1: Webhook authentication mechanisms
- Q4: Log injection via agent output
- Q5: Fleet/agent config merge override precedence
- Q7: Docker container user (root?)
- Q8: SDK wrapper prompt escaping
- Q9: Agent name validation completeness
- Q10: State file locking/atomicity
- Q11: Discord rate limiting

**Low Priority:**
- Q3: Container name special character handling

---

## Recommendations

### Immediate (None)
No critical issues require immediate action.

### This Week
1. **Implement job cleanup policy** (#010 mitigation)
   - Priority: MEDIUM
   - Effort: Low (2-4 hours)
   - Impact: Prevent unbounded .herdctl/jobs/ growth

2. **Run manual npm audit** (#008 verification)
   - Priority: MEDIUM
   - Effort: Trivial (5 minutes)
   - Impact: Confirm no untracked vulnerabilities

### This Month
3. **Investigate open questions Q1, Q4, Q7**
   - Priority: LOW-MEDIUM
   - Effort: Medium (4-8 hours)
   - Impact: Close knowledge gaps

4. **Fix shell escaping** (#009)
   - Priority: LOW
   - Effort: Trivial (15 minutes)
   - Impact: Defense-in-depth improvement

---

## Next Audit

**Scheduled:** 2026-02-15 (daily automated run)

**Focus Areas:**
1. Monitor #010 growth trend
2. Verify job cleanup policy implementation status
3. Check for new code commits
4. Track npm dependency updates

---

## Files Updated

- ‚úÖ `summaries/2026-02-14-v10.md` (this file)
- üîÑ `STATE.md` (to be updated)
- üîÑ `AUDIT-SUMMARY.md` (to be regenerated)

---

**Audit Complete:** 2026-02-14
**Next Review:** 2026-02-15 (automated daily)
**Status:** üü° YELLOW - Acceptable with monitoring
