# Security Intelligence Report - 2026-02-12

**Classification**: Internal Security Review
**Date**: 2026-02-12
**Report Type**: Daily Automated Audit
**Overall Status**: üü° YELLOW - New HIGH severity finding requires attention

---

## Executive Summary

The daily security audit has identified **one new HIGH severity finding** since the last review on 2026-02-06. Four commits have been merged, primarily focused on security infrastructure improvements. The new finding involves widespread use of `bypassPermissions` in production job configuration files.

### Status Indicators
- üî¥ RED: Critical vulnerabilities requiring immediate action
- üü° YELLOW: High severity findings that need attention
- üü¢ GREEN: No new findings or all findings accepted/tracked

**Current Status: üü° YELLOW**

### Key Metrics
- **Days Since Last Audit**: 6 days
- **Commits Since Last Audit**: 4 commits
- **New Findings**: 1 (HIGH severity)
- **Scanner Status**: FAIL (2 failed checks, 2 warnings, 2 passed)
- **Total Active Findings**: 6 (1 new + 5 existing)

---

## What Changed Since Last Audit

### Commit Activity (2026-02-06 to 2026-02-12)

4 commits merged, all focused on security infrastructure:

1. **2d6f5ba** (2026-02-11) - `refactor(security): restructure fleet config to standard format`
2. **1bf9d20** (2026-02-11) - `feat(security): add Discord chat integration to fleet config`
3. **f7287cc** (2026-02-11) - `chore(security): simplify fleet.yaml to invoke skill`
4. **371bbb7** (2026-02-09) - `feat(security): add subagents for reliable daily audit orchestration (#42)`

### Files Changed
- `.claude/agents/security/` - New security agent definitions (+778 lines)
- `.security/agent.yaml` - New agent configuration (+65 lines)
- `.security/fleet.yaml` - Removed fleet config (-104 lines)
- `herdctl.yaml` - New fleet config (+8 lines)
- Security audit skill definitions updated

### Security Impact Analysis
**Security-Focused Changes**: All commits relate to security infrastructure improvements. These changes restructure how the security agent operates, moving from a fleet-based approach to a skill-based approach with Discord integration.

**Code Touch Points**: No changes to core security-sensitive code (authentication, path handling, Docker config, etc.). All changes are in the security tooling layer.

---

## Scanner Results Comparison

### 2026-02-06 Scan (Last Audit)
- **Status**: FAIL
- **Checks**: 2 passed, 3 warned, 1 failed
- **Total Findings**: 10 findings

### 2026-02-12 Scan (Today)
- **Status**: FAIL
- **Checks**: 2 passed, 2 warned, 2 failed
- **Total Findings**: 10 findings

### Differences Detected

#### NEW FINDING ‚ö†Ô∏è
**ID**: #010 (tentative - needs assignment)
**Severity**: HIGH
**Check**: permission-modes
**Status Change**: WARN ‚Üí FAIL (escalated to FAIL due to production usage)

**Description**: `bypassPermissions` detected in 19 production job configuration files in `.herdctl/jobs/`

**Locations**:
```
.herdctl/jobs/job-2026-02-12-aj4aj0.yaml:51
.herdctl/jobs/job-2026-02-12-sjkgqo.yaml:83
.herdctl/jobs/job-2026-02-12-9oz7be.yaml:65
.herdctl/jobs/job-2026-02-12-pw00v4.yaml:66
.herdctl/jobs/job-2026-02-12-eq2f8e.yaml:108
.herdctl/jobs/job-2026-02-12-55049m.yaml:52
.herdctl/jobs/job-2026-02-12-55049m.yaml:113
.herdctl/jobs/job-2026-02-12-55049m.yaml:143
.herdctl/jobs/job-2026-02-12-r4gi8w.yaml:70
.herdctl/jobs/job-2026-02-12-hak8zr.yaml:46
.herdctl/jobs/job-2026-02-12-p17eg9.yaml:74
.herdctl/jobs/job-2026-02-12-p17eg9.yaml:87
.herdctl/jobs/job-2026-02-12-bx63b1.yaml:39
.herdctl/jobs/job-2026-02-12-bx63b1.yaml:70
.herdctl/jobs/job-2026-02-12-1vb8ws.yaml:65
.herdctl/jobs/job-2026-02-12-1vb8ws.yaml:102
.herdctl/jobs/job-2026-02-12-s20pip.yaml:110
.herdctl/jobs/job-2026-02-12-6ift81.yaml:78
.herdctl/jobs/job-2026-02-12-6ift81.yaml:90
```

**Analysis**:
- Previous scan (2026-02-06) only detected `bypassPermissions` in 1 example config
- Current scan detects 19 instances in **production** `.herdctl/jobs/` files
- These are job metadata files created during actual fleet operations
- `bypassPermissions` disables ALL safety checks including path traversal protection
- This significantly increases risk surface if job configs are influenced by external input

**Risk Assessment**:
- **Likelihood**: Medium (depends on how job configs are created)
- **Impact**: High (complete bypass of security controls)
- **Overall**: HIGH severity

**Questions to Investigate**:
1. How are job configuration files created? (User input? Template expansion?)
2. Can job configs be influenced by agent output or external triggers?
3. Is `bypassPermissions` necessary for job execution or inherited from agent config?
4. Should job configs inherit runtime settings from agent config or be isolated?

#### CHANGED FINDING
**ID**: #008
**Finding**: npm audit vulnerabilities
**Previous**: "2 moderate vulnerabilities found"
**Current**: "Could not parse pnpm audit output - manual review recommended"

**Analysis**: Scanner utility changed or npm audit format changed. The underlying vulnerability state is unclear. Manual verification needed.

---

## Detailed Findings Breakdown

### Critical (0)
_No critical findings_

### High (2) - 1 NEW
1. **#002** - hostConfigOverride bypass (ACCEPTED RISK - documented)
2. **#010** - bypassPermissions in production job configs ‚ö†Ô∏è NEW

### Medium (4)
1. **#005** - bypassPermissions in example config (INTENTIONAL)
2. **#006** - shell:true in hook runner (ACCEPTED RISK)
3. **#008** - npm audit vulnerabilities (TRACKED - Dependabot)
4. **subprocess-patterns** - shell:true in 2 locations (EXISTING - tracked as #006)

### Low (2)
1. **#009** - Incomplete shell escaping (TECH DEBT)
2. **subprocess-patterns** - Direct child_process usage in 2 files (TECH DEBT)

---

## Recommendations

### Immediate Actions (HIGH Priority)

**NEW FINDING #010: Investigate bypassPermissions in Job Configs**

Action items:
1. **Code Review**: Examine job creation logic in `packages/core/src/state/`
   - How are job metadata files created?
   - Do they inherit `bypassPermissions` from agent config?
   - Is this setting necessary for job execution?

2. **Verify Trust Boundaries**:
   - Are job configs created entirely from trusted fleet config?
   - Can agent output or external triggers influence job config?
   - Is there a scenario where user-controlled data flows into job metadata?

3. **Risk Mitigation Options**:
   - **Option A**: Remove `bypassPermissions` from job metadata (if not needed)
   - **Option B**: Document as accepted risk if jobs are fully trusted
   - **Option C**: Add additional validation layer for job execution

4. **Update FINDINGS-INDEX.md**: Assign formal ID #010 after investigation

### Medium Priority

**#008: Verify npm Audit Status**
- Run `pnpm audit` manually to confirm vulnerability state
- Compare with Dependabot alerts
- Update scanner if pnpm audit output format changed

### Ongoing Monitoring

**Scanner Coverage**: All checks passing or with known acceptable findings:
- ‚úÖ path-safety: PASS (0 findings)
- ‚úÖ env-handling: PASS (0 findings)
- ‚ö†Ô∏è npm-audit: WARN (parser issue, needs manual check)
- ‚ö†Ô∏è subprocess-patterns: WARN (2 low, 2 medium - all accepted)
- ‚ùå docker-config: FAIL (3 high - all accepted risk #002)
- ‚ùå permission-modes: FAIL (1 high NEW, 1 low existing)

---

## Context for Next Audit

### Investigation Queue
Priority order for next security review:

1. **HIGH**: NEW #010 - bypassPermissions in production jobs
2. **MEDIUM**: #008 - Verify npm audit status
3. **MEDIUM**: Q1, Q4, Q5, Q7, Q8 from CODEBASE-UNDERSTANDING.md
4. **LOW**: #009 - Shell escaping tech debt

### State Updates Needed

When NEW #010 is investigated, update:
- `intel/FINDINGS-INDEX.md` - Add formal finding #010
- `STATE.md` - Update active findings count and priority queue
- `CODEBASE-UNDERSTANDING.md` - Document job creation mechanism (if gap found)

### Staleness Status
- **Last mapping**: 2026-02-06 (6 days ago)
- **Last audit**: 2026-02-06 (6 days ago)
- **Commits since**: 4 commits (security infrastructure only)
- **Staleness**: Within acceptable threshold (<7 days, <15 commits)

---

## Audit Trail

- **Scanner Run**: 2026-02-12 17:03:50 UTC
- **Commit Analyzed**: 2d6f5ba (feature/simplify-security-fleet-yaml)
- **Branch**: feature/simplify-security-fleet-yaml
- **Scanner Duration**: 286ms
- **Report Generated**: 2026-02-12
- **Analyst**: Security Agent (automated)

---

## Appendix: Full Scanner Output

### Check Results Summary
```
npm-audit:          WARN (1 finding)  - 3ms
docker-config:      FAIL (3 findings) - 130ms
permission-modes:   FAIL (2 findings) - 23ms
subprocess-patterns: WARN (4 findings) - 30ms
path-safety:        PASS (0 findings) - 3ms
env-handling:       PASS (0 findings) - 88ms
```

### Scanner Status: FAIL
- Total: 6 checks
- Passed: 2
- Warned: 2
- Failed: 2

**Overall Assessment**: Scanner correctly identified new security concern in production configuration. Manual investigation required.

---

**Report Classification**: Internal Security Review
**Distribution**: Security team, repository maintainers
**Next Scheduled Audit**: 2026-02-19 (7 days) or after significant code changes
