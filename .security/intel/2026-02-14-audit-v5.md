# Security Audit Report - 2026-02-14 v5

**Date:** 2026-02-14 13:03 UTC
**Commit:** 458bc9a (HEAD)
**Branch:** security-audit-2026-02-14
**Audit Type:** Daily Incremental
**Scanner Duration:** 299ms
**Overall Status:** RED (CRITICAL)

---

## Executive Summary

CRITICAL FINDING #010 REMAINS AT RED STATUS. The bypassPermissions issue continues at 103 occurrences across production job files, unchanged from the previous audit (v4 at 12:08 UTC). No new code changes detected - only security documentation updates committed.

**Key Metrics:**
- Scanner Status: FAIL (2 failed checks, 2 warnings)
- bypassPermissions: 106 total occurrences (103 in .herdctl/jobs/, 3 in examples)
- Total Job Files: 66 YAML files in .herdctl/jobs/
- Code Changes: NONE (0 commits with code changes since last audit)
- Commits Since Last Audit: 1 (458bc9a - security doc update only)
- Time Since Last Audit: ~1 hour (12:08 to 13:03 UTC)

**Risk Assessment:** RED
- Finding #010 remains CRITICAL priority
- No growth detected this audit cycle (stable at 103)
- No new vulnerabilities introduced
- P0 action still required: STOP creating audit jobs, implement cleanup policy

---

## Phase 1: Scanner Results

### Overall Scanner Status: FAIL

**Summary:** 6 checks | 2 PASSED | 2 WARNED | 2 FAILED | 299ms

### Failed Checks

#### 1. docker-config (FAIL)
**Status:** FAIL (3 findings - ACCEPTED RISK)
**Finding #002:** hostConfigOverride bypass

| Location | Severity | Status |
|----------|----------|--------|
| docker-config.ts:260 | HIGH | Accepted Risk |
| container-manager.ts:142 | HIGH | Accepted Risk |
| container-manager.ts:143 | HIGH | Accepted Risk |

**Assessment:** These findings are documented accepted risks required for advanced Docker configuration at fleet level. No change from previous audits.

#### 2. permission-modes (FAIL)
**Status:** FAIL (2 findings - 1 CRITICAL, 1 LOW)
**Finding #010:** bypassPermissions in production jobs

| Metric | Value | Change from v4 |
|--------|-------|----------------|
| Total occurrences | 106 | +0 |
| Production (.herdctl/jobs/) | 103 | +0 |
| Examples | 3 | +0 |
| Unique job files affected | ~50-60 | ~same |
| Total job files | 66 | -0 |

**Growth Analysis:**
```
2026-02-14 12:08 (v4): 103 occurrences
2026-02-14 13:03 (v5): 103 occurrences
Change: +0 (+0.0%)
```

**Assessment:** CRITICAL finding remains stable. No growth this audit cycle, which is expected since no new security audits were spawned between v4 (12:08) and v5 (13:03). The P0 CRITICAL action from v4 remains: STOP creating audit jobs and implement cleanup policy.

### Warning Checks

#### 3. npm-audit (WARN)
**Status:** WARN (Finding #008)
**Issue:** Cannot parse pnpm audit output
**Recommendation:** Manual verification needed
**Assessment:** Existing medium-severity finding, tracked via Dependabot

#### 4. subprocess-patterns (WARN)
**Status:** WARN (4 findings - ACCEPTED RISKS)

| Location | Severity | Status |
|----------|----------|--------|
| shell.ts:8 (child_process import) | LOW | Accepted |
| sessions.ts:14 (child_process import) | LOW | Accepted |
| shell.ts:154 (shell: true) | MEDIUM | Accepted (#006) |
| sessions.ts:415 (shell: true) | MEDIUM | Accepted (#006) |

**Assessment:** All findings are accepted risks documented in THREAT-MODEL.md

### Passed Checks

- path-safety: PASS (0 findings, 3ms)
- env-handling: PASS (0 findings, 89ms)

---

## Phase 2: Change Analysis

### Commits Since Last Audit

**Commits Analyzed:** 1 commit (458bc9a)

**Commit:** 458bc9a
**Author:** security-audit
**Date:** 2026-02-14 12:13:41 +0000
**Message:** security: Daily audit 2026-02-14 v4 - CRITICAL RED status

**Files Changed:**
```
.security/DAILY-AUDIT-2026-02-14-v4.md       | 202 ++++
.security/STATE.md                           |  53 +-
.security/intel/2026-02-14-daily-audit-v4.md | 281 +++++
.security/intel/FINDINGS-INDEX.md            |  78 +-
.security/scans/2026-02-14.json              |  18 +-
.security/summaries/2026-02-14-v4-summary.md | 175 +++
6 files changed, 770 insertions(+), 37 deletions(-)
```

**Analysis:** Security documentation updates only. No source code changes, no new features, no bug fixes. This is the expected commit from the previous audit (v4).

**Security Impact:** NONE - Documentation changes carry no security risk

**Risk Level:** GREEN - No code changes

---

## Phase 3: Findings Summary

### Active Findings (6 total)

| ID | Severity | Title | Status | Change |
|----|----------|-------|--------|--------|
| 010 | CRITICAL | bypassPermissions in 103 jobs | RED | No change (+0) |
| 002 | High | hostConfigOverride bypass | Accepted | No change |
| 005 | Medium | bypassPermissions in examples | Intentional | No change |
| 006 | Medium | shell:true in hooks | Accepted | No change |
| 008 | Medium | npm audit parser error | Tracked | No change |
| 009 | Low | Incomplete shell escaping | Tech Debt | No change |

### Finding #010 Deep Dive (CRITICAL)

**Current State:**
- 103 bypassPermissions occurrences in .herdctl/jobs/
- 66 total job YAML files
- Growth rate: 0.0% this audit (stable)
- Status: CRITICAL RED (unchanged from v4)

**Growth History:**
```
2026-02-12:      61 files (initial detection)
2026-02-13:      69 files (+8, +13.1%)
2026-02-14 00:10: 85 files (+13, +18.1%)
2026-02-14 02:06: 87 files (+2, +2.4%)
2026-02-14 04:05: 87 files (+0, 0%)
2026-02-14 06:04: 91 files (+4, +4.6%)
2026-02-14 12:08: 103 files (+12, +13.2%) ← v4 ESCALATION
2026-02-14 13:03: 103 files (+0, 0.0%)    ← v5 STABLE
```

**Why Still CRITICAL:**
1. Exposure remains at 103 occurrences (unchanged)
2. No cleanup policy implemented yet
3. P0 action from v4 not yet addressed
4. Risk unchanged: ALL safety checks bypassed in 103 instances

**Immediate Actions Required (from v4, still applicable):**
1. P0 CRITICAL: STOP creating new security audit jobs
2. P0 CRITICAL: Implement job file retention policy (keep 7-14 days)
3. P1 HIGH: Review all 103 job files for actual security issues
4. P1 HIGH: Archive or delete old job files
5. P2 MEDIUM: Consider removing bypassPermissions from audit configs

---

## Phase 4: Hot Spot Verification

### Scanner Hot Spots

No new hot spots detected. All findings are existing tracked issues.

**Verification Status:** NOT REQUIRED
- Reason: No code changes detected
- All findings unchanged from v4
- Scanner results identical to previous run

---

## Phase 5: Open Questions Status

**Total Open Questions:** 9 (unchanged)

**Priority Breakdown:**
- High: 0
- Medium: 8 (Q1, Q4, Q5, Q7, Q8, Q9, Q10, Q11)
- Low: 1 (Q3)

**No updates to questions this audit** - no code changes means no new context for answering questions.

---

## Overall Security Assessment

### Status: RED (CRITICAL - UNCHANGED)

**Rationale:**
- Finding #010 remains at CRITICAL severity with 103 occurrences
- No cleanup policy implemented (P0 action pending)
- No code changes detected, so no new risks introduced
- Existing CRITICAL risk persists unchanged

### Findings Breakdown

| Severity | Count | Status |
|----------|-------|--------|
| CRITICAL | 1 | ESCALATED (Finding #010) |
| High | 1 | Accepted Risk (Finding #002) |
| Medium | 3 | 2 Accepted, 1 Tracked |
| Low | 1 | Tech Debt |

### Security Posture

**Current Posture:** CRITICAL RISK PERSISTS
- No improvement from v4
- No degradation from v4
- Stable but still CRITICAL

**Recommended Next Steps:**
1. IMMEDIATE: Implement job cleanup policy (P0)
2. IMMEDIATE: Stop creating new audit jobs until cleanup implemented (P0)
3. HIGH: Review and archive old job files (P1)
4. MEDIUM: Consider alternative audit approach without bypassPermissions (P2)

---

## Comparison with Previous Audit (v4)

| Metric | v4 (12:08) | v5 (13:03) | Change |
|--------|------------|------------|--------|
| Overall Status | RED | RED | Same |
| bypassPermissions Count | 103 | 103 | +0 |
| Total Job Files | 66 | 66 | +0 |
| Scanner Duration | 316ms | 299ms | -17ms |
| Code Changes | 0 | 0 | Same |
| New Findings | 0 | 0 | Same |

**Summary:** No material changes between v4 and v5. The 55-minute gap between audits showed no new security concerns but also no progress on addressing the CRITICAL P0 issue.

---

## Recommendations

### IMMEDIATE (P0 - CRITICAL)

1. **STOP creating security audit jobs**
   - Disable automated /security-audit-daily until cleanup policy implemented
   - Each audit adds to the bypassPermissions exposure
   - Current approach is self-defeating (security audits creating security risk)

2. **Implement job retention policy**
   - Keep only last 7-14 days of job files
   - Archive older jobs to .herdctl/jobs/archive/
   - Add automated cleanup on fleet start
   - Estimated impact: Reduce from 103 to ~20-30 occurrences

### HIGH (P1)

3. **Manual job file cleanup**
   - Review all 66 job files
   - Archive or delete files older than 14 days
   - Verify no active jobs before deletion

4. **Review audit agent configuration**
   - Assess if bypassPermissions is truly required for audits
   - Consider Docker volume mounts as safer alternative
   - Explore read-only filesystem access patterns

### MEDIUM (P2)

5. **npm audit verification** (Finding #008)
   - Run `pnpm audit` manually
   - Update scanner to parse pnpm output correctly

6. **Open questions** (Q1, Q4, Q7)
   - Webhook authentication (Q1)
   - Log injection via agent output (Q4)
   - Container user configuration (Q7)

### LOW (P3)

7. **Shell escaping improvement** (Finding #009)
   - Add complete escaping for `$`, `` ` ``, `!` in Docker prompts
   - Low risk but good defense-in-depth

---

## Audit Artifacts

**Generated Files:**
- Intelligence report: `.security/intel/2026-02-14-audit-v5.md` (this file)
- Scanner results: `.security/scans/2026-02-14.json` (reused from v4)
- Updated STATE.md with v5 audit metadata

**Next Audit:**
- Recommended: ONLY after P0 cleanup policy implemented
- Expected: Job file count should drop to ~20-30
- Target: bypassPermissions reduced by 60-70%

---

**End of Audit Report**
